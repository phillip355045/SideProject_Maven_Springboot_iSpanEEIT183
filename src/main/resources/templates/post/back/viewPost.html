<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/">
<head>
<meta charset="UTF-8">
<link th:href="@{/css/backFrom.css}" rel="stylesheet" type="text/css">
<title>è²¼æ–‡ç¸½è¦½</title>
<style>
.custom-html-class {
    background-color: #ffffff; /* èƒŒæ™¯è®Šæˆç™½è‰² */
    color: #000000; /* æ‰€æœ‰æ–‡å­—è®Šæˆé»‘è‰² */
}
/*----------------------------------------------*/
/* Title */
.h3-class {
    color: inherit; /* ç¹¼æ‰¿<html>çš„æ–‡å­—é¡è‰² */
    font-size: 1.5em;
    margin-bottom: 15px;
    margin-top: 15px;
    flex-grow: 1; /* ä½¿æ ‡é¢˜å æ®å‰©ä½™ç©ºé—´ */
    text-align: left;
}

/* Post Details */
.post-details {
    display: flex;
    align-items: center; /* å‚ç›´å¯¹é½ */
    justify-content: space-between; /* æ°´å¹³ç©ºé—´åˆ†é… */
    position: relative;
}

.edit-button {
   margin-top: 15px;
    margin-bottom: 15px; /* èˆ‡ä¸‹æ–¹å…ƒç´ ä¿æŒé©ç•¶é–“è· */
    margin-left: auto;
	/*display: inline-block;*/
    display: flex;
    vertical-align: top;
    gap: 20px; /* æŒ‰éˆ•ä¹‹é–“çš„é–“éš” */
}

/*----------------------------------------------*/
/* Post Container */
.post-container {
    border: 1px solid #ddd;
    padding: 15px;
    margin: 15px 0;
    border-radius: 8px;
    background-color: #f9f9f9;
    position: relative; /* ä¸ºäº†æ”¾ç½®æŒ‰é’®åœ¨å·¦ä¸‹è§’ */
}

/* Post Header */
.post-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.post-info {
    display: flex;
    align-items: center;
    gap: 10px; /* å¢åŠ é—´è· */
}

.post-emp-name {
    font-weight: bold;
    color: #2c3e50;
    font-size: 1.2em;
    display: flex;
    align-items: center;
}

.post-category {
    font-style: italic;
    color: #16a085;
    font-size: 1em;
    display: flex;
    align-items: center;
}

.post-emp-name::before {
    content: "ğŸ‘¤"; /* å‘æ–‡è€…å›¾æ ‡ */
    margin-right: 5px;
}

.post-category::before {
    content: "ğŸ“"; /* è´´æ–‡åˆ†ç±»å›¾æ ‡ */
    margin-right: 5px;
}

.post-actions .post-date {
    color: #7f8c8d;
    font-size: 0.9em;
}

/* Post Content */
.post-content {
    margin-top: 10px;
}

.post-text div {
    text-align: left; /* æ–‡æœ¬å·¦å¯¹é½ */
}

/* Image Gallery */
.image-gallery {
    text-align: center;
}

.image-gallery .image-container {
    display: inline-block;
    margin: 20px; /* å¢åŠ å¤–è¾¹è· */
    padding: 15px; /* å¢åŠ å†…è¾¹è· */
    background: #fff; /* èƒŒæ™¯é¢œè‰² */
    border: 1px solid #ddd; /* è¾¹æ¡† */
    border-radius: 10px; /* åœ†è§’ */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* æ·»åŠ é˜´å½± */
    width: 300px; /* å›ºå®šå®¹å™¨å®½åº¦ */
    height: 200px; /* å›ºå®šå®¹å™¨é«˜åº¦ */
    overflow: hidden; /* éšè—æº¢å‡ºå†…å®¹ */
    position: relative;
}

.image-gallery img {
    max-width: 100%; /* å›¾ç‰‡æœ€å¤§å®½åº¦ */
    max-height: 100%; /* å›¾ç‰‡æœ€å¤§é«˜åº¦ */
    position: absolute; /* ç»å¯¹å®šä½ */
    top: 50%; /* å‚ç›´å±…ä¸­ */
    left: 50%; /* æ°´å¹³å±…ä¸­ */
    transform: translate(-50%, -50%); /* ç§»åŠ¨åˆ°å®¹å™¨ä¸­å¿ƒ */
}

/* Like Section */
.like-section {
    position: absolute;
    bottom: 10px;
    left: 10px;
    display: flex;
    align-items: center;
    gap: 10px; /* æŒ‰é’®å’Œç‚¹èµæ•°ä¹‹é—´çš„é—´è· */
}

/* Buttons */
.like-button-class,  .comment-submit-class {
    padding: 8px 12px;
    border: none;
    border-radius: 5px;
    background-color: #B766AD; 
    color: white;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.3s;
}

.like-button-class:hover, .comment-submit-class:hover {
    background: #e6b800;
}


.comment-button-class-update{
 	padding: 8px 12px;
    border: 1px solid #000000;
    border-radius: 5px;
    /*background-color: #28a745; ç¶ è‰²èƒŒæ™¯ */
    color: #000000;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.3s, color 0.3s;
}

.comment-button-class-update:hover{
	background-color: #8E8E8E;
	color: white;
}

.comment-button-class{
 	padding: 8px 12px;
    border: 1px solid #000000;
    border-radius: 5px;
    /*background-color: #28a745; ç¶ è‰²èƒŒæ™¯ */
    background-color: #000000;
    color: white;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.3s, color 0.3s;
}

.comment-button-class:hover{
	background-color: #8E8E8E;
	color: #000000;
}


.btn-primaryII {
	padding: 8px 12px;
   	/*
   	border: 1px solid #000;
   	*/
   	border: none;
    border-radius: 5px;
    background-color: #B766AD; 
    color: white;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.3s;
}

.btn-primaryII:hover {
	
	background-color:#e6b800;
	/*background-color:#4f66cc;*/
}

.comment-button-classII{
    padding: 8px 12px;
   	border: 1px solid #000;
    border-radius: 5px;
    background-color: #ffcc00; /* é»ƒè‰²èƒŒæ™¯ */
    color: black;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.3s;
}

.comment-button-classII:hover{
	background-color: #e6b800; /* hover æ•ˆæœé¡è‰² */
}

.like-count-class {
    font-size: 1em;
    color: #2c3e50;
    font-weight: bold;
}

/*----------------------------------------------*/
/* Comment Form */
.comment-form-class {
    margin-top: 20px;
    width: 100%;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #f9f9f9;
}

.small-textarea-class {
    width: 100%;
    height: 80px; /* å°†é«˜åº¦æ”¹å° */
    padding: 10px;
    border: 1px solid #000;
    border-radius: 5px;
    box-sizing: border-box;
    resize: vertical;
    margin-bottom: 10px;
}

.button-container {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

/*----------------------------------------------*/
/* Separator */
.separator {
    border-bottom: 2px solid #000;
    margin: 20px 0;
}

/*----------------------------------------------*/
/* Comment Container */
.comment-container-class {
    margin-top: 20px;
    width: 100%;
    text-align: left;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #f9f9f9;
}

/* Comment List */
.comment-ul-class {
    list-style: none;
    padding: 0;
    margin: 0;
}

/* Comment Item */
.comment-item-class {
    padding: 10px;
    border: 1px solid #ddd; /* è°ƒæ•´ä¸ºæµ…è‰²è¾¹æ¡† */
    border-radius: 5px;
    margin-bottom: 10px;
    background-color: #f9f9f9; /* å°†èƒŒæ™¯è‰²æ”¹ä¸ºå¤–å±‚èƒŒæ™¯è‰² */
    display: flex;
    flex-direction: column;
    position: relative;
}

/* Comment Header */
.comment-header {
    display: flex;
    justify-content: flex-start; /* å°‡å…ƒç´ é å·¦å°é½Š */
    align-items: center; /* ç¢ºä¿å…ƒç´ å‚ç›´å±…ä¸­ */
    width: 100%;
    margin-bottom: 5px;
}

.comment-meta-wrapper {
    display: flex;
    align-items: center;
}

.comment-meta {
    font-weight: bold;
    color: #333;
}

.comment-colon {
    margin-left: 5px;
    margin-right: 5px;
    display: inline-block;
}

.comment-time {
    color: #7f8c8d;
    font-size: 0.9em;
    margin-left: auto; /* ç¢ºä¿æ™‚é–“æ®µé å³ */
}


/* Comment Text Container */
.comment-text-container {
    background-color: #fff; /* è®¾ä¸ºç™½è‰²èƒŒæ™¯ */
    border: 1px solid #ddd; /* æµ…è‰²è¾¹æ¡† */
    border-radius: 5px;
    padding: 10px;
}

/* Comment Text */
.comment-text {
    color: #555;
}

/* Comment Footer */
.comment-footer {
    display: flex;
    justify-content: space-between;
    align-items: center; /* ç¡®ä¿å…ƒç´ å‚ç›´å±…ä¸­ */
    width: 100%;
}
/*--------------------------------*/
/* Back Button Container */
.back-button-container {
    display: flex;
    justify-content: center;
    margin-top: 20px;
}

.back-button-class {
    padding: 10px 20px;
    border: 1px solid #000;
    border-radius: 5px;
    background-color: #ffcc00; /* ç»¿è‰²èƒŒæ™¯ */
    color: black;
    text-decoration: none;
    cursor: pointer;
    transition: background-color 0.3s;
}

.back-button-class:hover {
    background: #e6b800;
}
</style>
</head>
<body>
    <div th:replace="~{layout/backEmpNavbar}"></div>
    <div class="wrap">
        <div class="nav1"> <br> 
            <a th:href="@{/postsWithCategory(postCategory='ä¸€èˆ¬')}">ç¸½è¦½: ä¸€èˆ¬é¡åˆ¥</a>
            <a th:href="@{/postsWithCategory(postCategory='æ´»å‹•')}">ç¸½è¦½: æ´»å‹•é¡åˆ¥</a>
            <a th:href="@{/postsWithCategory(postCategory='è€ƒå‹¤')}">ç¸½è¦½: è€ƒå‹¤é¡åˆ¥</a>
            <a th:href="@{/postsWithCategory(postCategory='è–ªè³‡')}">ç¸½è¦½: è–ªè³‡é¡åˆ¥</a>
            <a th:href="@{/postsWithCategory(postCategory='ç¦åˆ©')}">ç¸½è¦½: ç¦åˆ©é¡åˆ¥</a>
        </div>
        <!-- 
        <input type="hidden" id="currentAccount" th:value="${session.account}">
         -->
        <div id="content" class="container">
            <div><input type="hidden" id="postId" th:value="${post.postId}" /></div>
            
            <div class="post-details">
                <h3 th:text="${post.postTitle}" class="h3-class"></h3>
                <div class="edit-button">
                    <form th:action="@{/showUpdatePostById.manager}" method="post">
                        <input type="hidden" name="postId" th:value="${post.postId}" />
                        <button type="submit" class="btn-primaryII">ç·¨è¼¯è²¼æ–‡</button>
                    </form>
                    <form th:action="@{/findAllPostUpdateRecords.manager}" method="post">
                        <input type="hidden" name="postId" th:value="${post.postId}" />
                        <button type="submit" class="btn-primaryII">ä¿®æ”¹ç´€éŒ„</button>
                    </form>
                </div>
            </div>

            <div class="post-container">
                <div class="post-header">
                    <div class="post-info">
                        <span class="post-emp-name" th:text="${post.postEmpName + '(' + post.postEmp + ')'}"></span>
                        <span class="post-category" th:text="${post.postCategory}"></span>
                    </div>
                    <div class="post-actions">
                        <div class="post-date" th:text="${post.postDate}"></div>
                    </div>
                </div>
                <div class="post-content">
                    <div class="post-text">
                        <div th:text="${post.postContent}" style="white-space: pre-wrap;"></div>
                    </div>
                    <div class="image-gallery">
                        <div th:if="${postImageUploads.size() > 0}">
                            <div th:each="postImageUpload : ${postImageUploads}" class="image-container">
                            	<img th:src="${postImageUpload.base64ImageData}" alt="Post Image">
                            </div>
                        </div>
                    </div>
                </div>
                <br>
                <br>
                <div class="like-section">
                    <input type="hidden" id="postId" th:value="${post.postId}" />
                    <button class="like-button-class" id="likeButton">æŒ‰è®š</button>
                    <button class="like-button-class" id="unlikeButton" style="display: none;">æ”¶å›è®š</button>
                    <span class="like-count-class" id="likeCounts">0 å€‹è®š</span>
                </div>
            </div>
            
            <div class="separator"></div>

            <form id="commentForm" class="comment-form-class">
                <div>
                    <textarea class="small-textarea-class" id="commentContent"
                        name="commentContent"
                        th:placeholder="${session.name} + ' æƒ³èªªç”šéº¼å—?'" required></textarea>
                </div>
                <input type="hidden" id="postId" name="postId"
                    th:value="${post.postId}" />
                <div class="button-container">
               		<button type="button" class="comment-button-classII" onclick="fillExampleData1()">ç¯„ä¾‹ç•™è¨€1</button>
                	<button type="button" class="comment-button-classII" onclick="fillExampleData2()">ç¯„ä¾‹ç•™è¨€2</button>
                    <button type="submit" class="comment-submit-class" id="submitButton" disabled>æäº¤</button>
                </div>
            </form>

            <div class="separator"></div>

			<div id="commentsContainer" class="comment-container-class">
				<ul class="comment-ul-class" id="commentList">
					<li th:each="comment : ${comments}" class="comment-item-class">
						<div class="comment-header">
							<div class="comment-meta-wrapper">
                   				<span class="comment-meta" th:text="${comment.commentEmp}">User</span>
                    			<span class="comment-colon">:</span>
                			</div>
							<span class="comment-time" th:text="${comment.commentDateTime}">Comment time</span>
						</div>
						<div class="comment-text-container">
							<span class="comment-text" th:text="${comment.commentContent}">Comment
								content</span>
						</div>
						<div>
							<!-- ä½¿ç”¨è€…åªèƒ½æ“ä½œè‡ªå·±çš„ç•™è¨€ -->
							<div class="button-container">
								<button class="comment-button-class-update"
									th:attr="data-comment-id=${comment.commentId}">ä¿®æ”¹</button>
								<button class="comment-button-class"
									th:attr="data-comment-id=${comment.commentId}">åˆªé™¤</button>
							</div>
						</div>
					</li>
				</ul>
			</div>
            
            <div class="back-button-container">
                <a class="back-button-class" th:href="@{/findAllPosts.controller}">å›åˆ°è²¼æ–‡æ˜ç´°é </a>
            </div>
        </div>
    </div>
    <div th:replace="~{layout/footer}"></div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.all.min.js"></script>
    
    
    <!-- ä¸€éµè¼¸å…¥ç¯„ä¾‹ç•™è¨€ -->
    <script>
    function fillExampleData1() {
        //ä¸€èˆ¬çš„html, cssè¼¸å…¥æ¡†
        document.getElementById('commentContent').value = 'æ¸¬è©¦ç•™è¨€- äº†è§£ï¼Œå¸Œæœ›ä¸€åˆ‡é †åˆ©ã€‚';
        document.getElementById('submitButton').disabled = false; // å•Ÿç”¨æäº¤æŒ‰éˆ•
    }
    
    function fillExampleData2() {
        //ä¸€èˆ¬çš„html, cssè¼¸å…¥æ¡†
        document.getElementById('commentContent').value = 'æ¸¬è©¦ç•™è¨€- æ„Ÿè¬é€šçŸ¥æ¶ˆæ¯çµ¦æˆ‘å€‘!!';
        document.getElementById('submitButton').disabled = false; // å•Ÿç”¨æäº¤æŒ‰éˆ•
    }

    </script>

    <!-- æ—¥æœŸæ ¼å¼åŒ–å‡½æ•¸ -->
    <script>
    function formatDateTime(dateTimeString) {
        let utcDate = new Date(dateTimeString);
        let year = utcDate.getUTCFullYear();
        let month = utcDate.getUTCMonth();
        let day = utcDate.getUTCDate();
        let hour = utcDate.getUTCHours();
        let minute = utcDate.getUTCMinutes();
        let second = utcDate.getUTCSeconds();
        let millisecond = utcDate.getUTCMilliseconds();
        let localDate = new Date(year, month, day, hour, minute, second, millisecond);
        return localDate.toLocaleString('zh-TW', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false
        });
    }
    </script>
    
    <!-- ä»¥ä¸‹æ˜¯ç•™è¨€è¼¸å…¥æ¡†ã€æŒ‰è®šå›æ‡‰çš„Ajaxç¨‹å¼ç¢¼ -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const postId = document.getElementById('postId').value;

        //
        document.getElementById('commentContent').addEventListener('input', function() {
            let commentContent = document.getElementById('commentContent').value;
            let submitButton = document.getElementById('submitButton');
            submitButton.disabled = !commentContent.trim();
        });

        const updateLikeStatus = () => {
            let params = new URLSearchParams();
            params.append('postId', postId);

            fetch('/PSNEXUS/getReactionStatus', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: params
            })
            .then(response => response.json())
            .then(data => {
                const likeCounts = data.likeCounts;
                const userReacted = data.userReacted;

                if (likeCounts !== undefined) {
                    const likeCountElement = document.getElementById('likeCounts');
                    likeCountElement.innerText = likeCounts + ' å€‹è®š';
                }

                if (userReacted) {
                    document.getElementById('likeButton').style.display = 'none';
                    document.getElementById('unlikeButton').style.display = 'inline';
                } else {
                    document.getElementById('likeButton').style.display = 'inline';
                    document.getElementById('unlikeButton').style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        };

        document.getElementById('likeButton').addEventListener('click', function() {
            let params = new URLSearchParams();
            params.append('reactionCategory', 'like');
            params.append('postId', postId);

            fetch('/PSNEXUS/insertReaction', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: params
            })
            .then(response => response.json())
            .then(data => {
                const likeCounts = data.likeCounts;
                if (likeCounts !== undefined) {
                    const likeCountElement = document.getElementById('likeCounts');
                    likeCountElement.innerText = likeCounts + ' å€‹è®š';
                    document.getElementById('likeButton').style.display = 'none';
                    document.getElementById('unlikeButton').style.display = 'inline';
                } else {
                    alert('æŒ‰è®šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('æŒ‰è®šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
            });
        });

        document.getElementById('unlikeButton').addEventListener('click', function() {
            let params = new URLSearchParams();
            params.append('reactionCategory', 'like');
            params.append('postId', postId);

            fetch('/PSNEXUS/deleteReaction', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: params
            })
            .then(response => response.json())
            .then(data => {
                const likeCounts = data.likeCounts;
                if (likeCounts !== undefined) {
                    const likeCountElement = document.getElementById('likeCounts');
                    likeCountElement.innerText = likeCounts + ' å€‹è®š';
                    document.getElementById('likeButton').style.display = 'inline';
                    document.getElementById('unlikeButton').style.display = 'none';
                } else {
                    alert('æ”¶å›è®šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('æ”¶å›è®šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
            });
        });

        updateLikeStatus();

        //
        document.getElementById('commentForm').addEventListener('submit', function(event) {
            event.preventDefault(); 

            let commentContent = document.getElementById('commentContent').value;

            let dtoObject = {
                postId: postId,
                commentContent: commentContent
            };

            fetch('/PSNEXUS/insertNewComment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dtoObject)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                alert('Comment added successfully!');
                document.getElementById('commentContent').value = ''; 
                document.getElementById('submitButton').disabled = true; 
                fetchComments(postId);
            })
            .catch(error => console.error('Error:', error));
        });
//------------------------------------------------
    const fetchComments = (postId) => {
        fetch(`/PSNEXUS/findAllComments`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }, 
            body: JSON.stringify({ postId })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            let commentsContainer = document.getElementById('commentList');
            commentsContainer.innerHTML = ''; 
            data.forEach(comment => {
                let commentId = comment.commentId;
                let commentContent = comment.commentContent;
                let commentEmp = comment.commentEmp;
                let commentDateTime = formatDateTime(comment.commentDateTime);
                let commentEmpName = comment.commentEmpName;

                let commentElement = document.createElement('li');
                commentElement.className = 'comment-item-class';

                let commentHeader = document.createElement('div');
                commentHeader.className = 'comment-header';

                let commentMeta = document.createElement('span');
                commentMeta.className = 'comment-meta';
                commentMeta.textContent = commentEmpName + "(" + commentEmp + ")";

                let colon = document.createElement('span');
                colon.className = 'comment-colon';
                colon.textContent = ':';

                let commentTime = document.createElement('span');
                commentTime.className = 'comment-time';
                commentTime.textContent = commentDateTime;

                commentHeader.appendChild(commentMeta);
                commentHeader.appendChild(colon);
                commentHeader.appendChild(commentTime);

                let commentText = document.createElement('span');
                commentText.className = 'comment-text';
                commentText.textContent = commentContent;

                commentElement.appendChild(commentHeader);
                commentElement.appendChild(commentText);

                // ç²å¾—ç•¶å‰ç™»å…¥çš„ç”¨æˆ¶è³‡è¨Š
                //let currentAccount = document.getElementById('currentAccount').value;

                //ç®¡ç†è€…ä¸ç”¨åˆ¤æ–·èª°å¯ä»¥å‡ºç¾"ä¿®æ”¹"ã€"åˆªé™¤"æŒ‰éˆ•
                    let editButton = document.createElement('button');
                    editButton.textContent = 'ä¿®æ”¹';
                    editButton.className = 'comment-button-class-update';
                    editButton.setAttribute('data-comment-id', commentId);
                    editButton.addEventListener('click', () => {
                        let newCommentContent = prompt('è«‹è¼¸å…¥æ–°çš„ç•™è¨€å…§å®¹:', commentContent);
                        if (newCommentContent !== null) {
                            updateComment(commentId, newCommentContent, postId); 
                        }
                    });

                    let deleteButton = document.createElement('button');
                    deleteButton.textContent = 'åˆªé™¤';
                    deleteButton.className = 'comment-button-class';
                    deleteButton.setAttribute('data-comment-id', commentId);
                    deleteButton.addEventListener('click', () => {
                        deleteComment(commentId, postId);
                    });

                    let buttonContainer = document.createElement('div');
                    buttonContainer.className = 'button-container';
                    buttonContainer.appendChild(editButton);
                    buttonContainer.appendChild(deleteButton);

                    commentElement.appendChild(buttonContainer);
                //

                commentsContainer.appendChild(commentElement);
            });
        })
        .catch(error => console.error('Error:', error));
    };
//------------------------------------------------
        const updateComment = (commentId, newCommentContent, postId) => {
            fetch('/PSNEXUS/updateComment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ commentId, newCommentContent })
            })
            .then(response => {
                if (!response.ok) {
                    response.text().then(text => { throw new Error(text); });
                }
                return response.json();
            })
            .then(data => {
                alert('Comment updated successfully!');
                fetchComments(postId);
            })
            .catch(error => console.error('Error:', error));
        };

        const deleteComment = (commentId, postId) => {
            Swal.fire({
                title: 'ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ',
                text: "é€™å€‹æ“ä½œä¸èƒ½è¢«æ’¤éŠ·ï¼",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'æ˜¯çš„ï¼Œåˆªé™¤å®ƒï¼',
                cancelButtonText: 'å–æ¶ˆ'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch('/PSNEXUS/deleteComment', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: `commentId=${commentId}`
                    })
                    .then(response => {
                        if (response.status !== 204) {
                            throw new Error('Network response was not ok');
                        }
                        Swal.fire(
                            'å·²åˆªé™¤!',
                            'ä½ çš„è©•è«–å·²è¢«åˆªé™¤ã€‚',
                            'success'
                        );
                        fetchComments(postId);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        Swal.fire(
                            'éŒ¯èª¤!',
                            'åˆªé™¤è©•è«–æ™‚å‡ºç¾éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚',
                            'error'
                        );
                    });
                }
            });
            fetchComments(postId);
        };

        // é é¢åŠ è¼‰æ™‚èª¿ç”¨ä»¥é¡¯ç¤ºè©•è«–
        fetchComments(postId);
    });
    </script>

    
</body>
</html>
